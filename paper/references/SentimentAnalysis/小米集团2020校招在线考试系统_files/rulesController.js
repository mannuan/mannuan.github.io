app.register("rulesController",["$scope","$http","$state","$location","$timeout","App",function($scope,$http,$state,$location,$timeout,App){$timeout(function(){selTab("rules");$("#navTab").show()});$scope.isPc=true;if(document.body.clientWidth<800){$scope.isPc=false}$scope.App=App;window.scrollTo(0,0);var mayTimer=null;var rendTimeFunc=function(){var lsecs=user.vipCode-App.serverTime.mayStarted;var ft={hours:"00",mins:"00",secs:"00"};if(lsecs>0)ft=App.formatTime(lsecs);$("#timeToStart").html("{0}:{1}:{2}".Format(ft.hours,ft.mins,ft.secs)).show();if(lsecs<=0){if(mayTimer){clearInterval(mayTimer);mayTimer=null}setTimeout(function(){$("#btnStartExam").removeAttr("disabled");$("#dvStartExam").show()},1e3)}};$scope.goToStart=function(paperId,rowNumber){var strTo="";console.log("in goToStart");console.log("App.serverTime.usedTime: ",App.serverTime.usedTime);if(App.serverTime.usedTime<0){if(App.serverTime.timeType==3){$http.post("/cand/api/addLog",{action:"startExam"}).success(function(data){}).error(function(data){});strTo="start"}else{if(App.serverTime.usedTime>-10&&App.serverTime.usedTime<0){cxalert(ACM.lang.hint,ACM.lang.rules.notStart);return}strTo="#/main/practise";gotoHash(strTo);return}}else if(App.serverTime.usedTime>=0){if(App.serverTime.timeType==3||App.serverTime.unifiedExam==true){$http.post("/cand/api/addLog",{action:"startExam"}).success(function(data){}).error(function(data){});strTo="start"}else{if(isNaN(user.vipCode)){user.vipCode=0}if(isNaN(App.serverTime.mayStarted)){App.serverTime.mayStarted=0}var lsecs=user.vipCode-App.serverTime.mayStarted;console.log("user.vipCode: ",user.vipCode);console.log("App.serverTime.mayStarted: ",App.serverTime.mayStarted);console.log("lsecs: ",lsecs);if(lsecs<=0){$http.post("/cand/api/addLog",{action:"startExam"}).success(function(data){}).error(function(data){});strTo="start"}else{$("#dvTimend").modal({backdrop:"static"});if(mayTimer)clearInterval(mayTimer);mayTimer=setInterval(rendTimeFunc,1e3);return}}}strTo="#/main/{0}".Format(strTo);$scope.startExam(strTo)};$scope.goPrev=function(){if($scope.isPc==false){gotoHash("#/main/personalInfo")}else{if(App.myInfo.needMonit==1){gotoHash("#/main/monitor")}else if(App.myInfo.supervisor!=2){gotoHash("#/main/myPhoto")}else{gotoHash("#/main/personalInfo")}}};$scope.$on("user.startExam",function(e,d){console.log("user.startExam");$scope.startExam()});$scope.startExam=function(){var lsecs=user.vipCode-App.serverTime.mayStarted;console.log("user.vipCode: ",user.vipCode);console.log("App.serverTime.mayStarted: ",App.serverTime.mayStarted);console.log("lsecs: ",lsecs);if(App.serverTime.usedTime>0||App.serverTime.timeType==3||lsecs<=0){window.ACMGlobal.waitWarning=0;window.ACMGlobal.waitWarningFun=function(){if(window.ACMGlobal.waitWarning==0){cxalertNoBtn(ACM.lang.hint,'<div style="padding:20px;"><img src="https://cdn.acmcoder.com/release/exam/2.0.2/images/load.gif" style="height:40px;width:40px;"> &nbsp;&nbsp; '+ACM.lang.rules.pleaseWaiting+"</div>")}};setTimeout("window.ACMGlobal.waitWarningFun()",2e3);$http.post("/cand/api/startExam",{r:Math.random()}).success(function(data){sessionStorage.clear();window.ACMGlobal.waitWarning=1;$.cxDialog.close();if(data==-99){cxalertBack(ACM.lang.hint,ACM.lang.main.accountExpired,function(){location.href="/cand/login"});return}console.log("/cand/api/startExam: ",data);if(App.checkData(data,$state)){App.serverTime=data[1];App.cs=data[0];if(App.cs){$("#dvTimend").modal("hide");$http.post("/cand/api/addLog",{action:"startExam"}).success(function(data){}).error(function(data){});gotoHash("#/main/start")}else{alert($scope.App.lang.rules.paperRoad)}}else{if(Object.isNull(App.serverTime))App.serverTime={}}}).error(function(data){window.ACMGlobal.waitWarning=1;console.log(data)})}else{console.log("再等一下呗！")}};$timeout(function(){if(isMobile){$(".stepinfo .list ul li.cur span").html("02");$(".toolguider.rulesBtns a.bottom").attr("onclick","javascript: gotoHash('#/main/personalInfo');")}var limited=10;if(App.serverTime.usedTime>-10&&App.serverTime.usedTime<0){limited=-App.serverTime.usedTime}if($(".hasReadAbide").length==0){$('<div class="hasReadAbide" style="margin-left:25.05pt;text-align:center;"><input type="checkbox" id="ReadAbide" checked name="ReadAbide"> <label for="ReadAbide">'+ACM.lang.rules.ipromise+"</label></div>").appendTo(".stepform .rule");$("#ReadAbide").click(function(){if($("#ReadAbide").is(":checked")&&limited<=1){$(".toolguider.rulesBtns.limited a.next").removeAttr("disabled");$(".toolguider.rulesBtns.limited").removeClass("limited")}else{$(".toolguider.rulesBtns a.next").attr("disabled","disabled");$(".toolguider.rulesBtns").addClass("limited")}})}if($(".toolguider.rulesBtns .limitedred").length==0){$(".toolguider.rulesBtns a.next").append('<span class="limitedred">（10）</span>')}if(!$(".toolguider.rulesBtns").hasClass("limited")){$(".toolguider.rulesBtns").addClass("limited")}if($(".toolguider.rulesBtns a.next").attr("disabled")==undefined){$(".toolguider.rulesBtns a.next").attr("disabled","disabled")}$(".toolguider.rulesBtns .limitedred").html("（"+limited+"）");function timeLimitedFun(){if(App.serverTime.mayStarted<-10&&App.serverTime.timeType!=3){$("a.next .text").html(ACM.lang.main.startPractice)}else if(App.serverTime.mayStarted>=-10&&App.serverTime.timeType!=3){$("a.next .text").html(ACM.lang.main.startExam)}if(limited>1){limited--;if($(".toolguider.rulesBtns .limitedred").length==0){$(".toolguider.rulesBtns a.next").append('<span class="limitedred">（10）</span>')}if(!$(".toolguider.rulesBtns").hasClass("limited")){$(".toolguider.rulesBtns").addClass("limited")}if($(".toolguider.rulesBtns a.next").attr("disabled")==undefined){$(".toolguider.rulesBtns a.next").attr("disabled","disabled")}$(".toolguider.rulesBtns .limitedred").html("（"+limited+"）")}else{window.clearInterval(tl);$(".toolguider.rulesBtns .limitedred").remove();$(".toolguider.rulesBtns.limited a.next").attr("href","javascript:;");if($("#ReadAbide").is(":checked")){$(".toolguider.rulesBtns.limited a.next").removeAttr("disabled");$(".toolguider.rulesBtns.limited").removeClass("limited")}}}function TLimited(){window.clearInterval(window.tl);window.tl=window.setInterval(timeLimitedFun,1e3)}TLimited()})}]);